# üìò Architectural Blueprint: Student Management System (20 Models)

## 1. System Core & Multi-Tenancy (The Foundation üèõÔ∏è)

This group defines the boundaries, central configuration, and the ultimate super-administrator of your entire platform. This is the **most crucial layer** for security and scalability.

| **Model**               | **Purpose & Use**                                                                                                                                                                            | **DSE Core Concept**                                                                                                                                                                                 | **Possible Errors & Prevention**                                                                                                                                                                                             |
| ----------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **`Tenant.js`**       | **The School Boundary:**Defines each school (tenant) with its `name`and unique `subdomain`. It is the**primary data partition key**for all other models.                           | **Multi-Tenancy Isolation:**Forces data separation.**Prevention:**Write a global middleware that**forces**the `tenantId`into every single database query to prevent cross-tenant data leaks. |                                                                                                                                                                                                                                    |
| **`rootUser.js`**     | **The System Owner:**Holds the unique ID for the person who controls the application at the highest level (the owner/shareholder). Used for billing, global configuration, and system-wide audits. | **Super-Admin Identity & Audit Separation:**Keeps the most sensitive system audit trail logically separate from the daily school operations.                                                               | **Accidental Deletion:**Error if the document is deleted.**Prevention:**Implement hard deletion locks and require multi-factor authentication for any write operation on this model.                                               |
| **`TenantConfig.js`** | **The School's Settings Brain:**Stores school-specific branding,`smtp_settings`(for sending emails), and third-party keys like the `ai_api_key`.                                               | **Configuration Service (Centralized Configuration):**Externalizes dynamic application settings from the codebase, allowing you to change a school's logo or AI key instantly without a system reboot.     | **API Key Exposure:**Error if a low-privilege admin can read the AI key.**Prevention:**The key should be**encrypted at rest**in the database and only decrypted by the secure worker service that needs to use the AI. |

---

## 2. Identity, Authentication & Authorization (The Gatekeepers üîê)

This group manages who is allowed in, what their roles are, and their specific internal/external profile data.

| **Model**             | **Purpose & Use**                                                                                                                                                       | **DSE Core Concept**                                                                                                                                                     | **Possible Errors & Prevention**                                                                                                                                                                                                |
| --------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **`User.js`**       | **The Authentication Gateway:**Stores the login hash (`password`),`email`,`role`, and the critical `tenantId`. It is the*only*place users authenticate.             | **Authentication vs. Profile Separation:**Keeps authentication logic lean and fast, offloading complex profile data to `Staff.User.js`and `student.js`.                    | **Slow Login:**Error if the database is queried repeatedly.**Prevention:**Use**JWT Caching**to store the `role`,`tenantId`, and optional `studentId`/`staffId`in the client's token.                              |
| **`Permission.js`** | **The Rule Book:**Defines what `action`(`read`,`update`, etc.) each `role`(Admin, Teacher) can perform on which `resource`(StudentReport, StaffFinance).            | **Role-Based Access Control (RBAC):**Centralizes all security rules, making your system secure and easily audited.                                                             | **Unauthorized Action:**Error if a Teacher tries to 'delete' a `StudentReport`.**Prevention:**The API must use a**Permission Checker Middleware**that consults this model on *every single incoming request* .        |
| **`Staff.User.js`** | **The Staff Profile:**Stores job details, payroll info, and emergency contacts. Links to `User.js`via `user_id`.                                                          | **Data Normalization:**Keeps the core staff profile descriptive data separate from the high-traffic login data in `User.js`, optimizing read/write speeds for both.          | **Data Drift:**Error if two different parts of the staff profile are updated inconsistently.**Prevention:**Use**database transactions**to update dependent fields in both `User.js`and `Staff.User.js`simultaneously. |
| **`student.js`**    | **The Student Profile:**Stores core demographics,`enrollment_date`, and parent/emergency contacts. Links to `User.js`via `user_id`.                                     | **Data Normalization:**Moves high-traffic, non-core data (like `AcademicHistory.js`and finances) into separate collections for faster querying of a student's basic profile. | **Missing Data:**Error if a key field like `Tenant_id`is missing.**Prevention:**Use**Schema Validation**(as you have done with `required: true`) and run an initial data migration check on system startup.           |
| **`External.js`**   | **The External Users:**Manages non-staff/student users like**Parents, Guardians, and Shareholders** . Uses `associated_student_ids`to link parents to their children. | **Separation of External/Internal Access:**Limits external user access to internal operational data, which is a major security concept.                                        | **Access Violation:**Error if a Parent can see another student's data.**Prevention:**The API query must restrict parent access to only `student_id`values found in their `associated_student_ids`array.                           |

---

## 3. Financial Ledger & Audit (The Money Trail üí∞)

This group handles all financial transactions, ensuring **Strong Consistency** and providing a clear audit trail for the school's income, expenses, and payroll.

| **Model**                  | **Purpose & Use**                                                                                                     | **DSE Core Concept**                                                                                                                                                                 | **Possible Errors & Prevention**                                                                                                                                                                                                                                         |
| -------------------------------- | --------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **`Main.Finance.js`**    | **The Central Vault:**The authoritative, audited ledger for all school-wide income, expenses, and inventory.                | **Strong Consistency & Single Source of Truth (SSoT):**This data requires**Strong Consistency** ‚Äîthe value must always be the latest correct figure. It is the SSoT for accounting. | **Data Race/Double Spend:**Two clerks record income simultaneously, leading to a missed transaction.**Prevention:**Use**Atomic Operations**(like MongoDB's `$inc`) for updates to totals and ensure all records are part of a transaction.                       |
| **`Staff.Finance.js`**   | **Staff Payroll:**Tracks a single staff member's `Salary_Allocation`and `PaySlip`records.                               | **Decoupled Audit Log:**Separates the high-volume payroll data from the central finance ledger and core user profile, making staff-specific queries fast.                                  | **Inconsistent Data:**Error if a payment is recorded here but not in `Main.Finance.js`as an expense.**Prevention:**Every payment must be part of a**multi-document transaction**that updates both the staff's payslip and the central expense ledger atomically. |
| **`Student.Finance.js`** | **Student Billing:**Tracks a student's**BILLS**and **Payments** . Essential for calculating current debt. | **Data Normalization & Query Optimization:**Allows for quick, targeted queries of a student's balance without searching through the massive `Main.Finance`record.                        | **Billing Fraud:**Error if a student payment is recorded here but not in the `Main.Finance.js`income record.**Prevention:**Enforce a**two-phase commit**or**transaction**to ensure the payment entry is recorded in both models simultaneously.      |

---

## 4. Academics & Reporting Workflow (The Student Journey üßë‚Äçüéì)

This group manages the rule book for grading, the raw score input, the historical record, and the final generation of the report card.

| **Model**                  | **Purpose & Use**                                                                                                                                                  | **DSE Core Concept**                                                                                                                                                                                          | **Possible Errors & Prevention**                                                                                                                                                                                                                        |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **`GradingSystem.js`**   | **The Rule Engine:**Stores the grade weightings (e.g., 40% class, 60% exam) and the letter-grade conversion rules.                                                       | **Configuration Service (Centralized Rule Engine):**Guarantees**Eventual Consistency**in grading‚Äîonce the rules are set, every calculation uses the same logic.                                        | **Inconsistent Grading:**Error if the calculation uses an old version of the system.**Prevention:**The `StudentReport.js` **must**explicitly reference the `grading_system_id`used for the calculation, creating a permanent audit link.            |
| **`ScoreSubmission.js`** | **The Raw Data Collector:**Optimized for teachers to quickly submit raw scores for students for a specific `assessment_type`.                                          | **High-Speed Write Optimization:**This model is designed for maximum availability and high-speed**writes** , decoupling the data input from the slow calculation process.                                     | **Corrupted Input:**Error if a teacher submits the wrong class score.**Prevention:**Implement a**Workflow Status**field (`Draft`,`Submitted`,`Locked`) where the grade is locked by an Admin before it can be used for final reports.       |
| **`StudentReport.js`**   | **The AI Workflow Manager:**The centerpiece of the report card process. It tracks the AI generation `status`and holds the link (`report_file_url`) to the final PDF. | **Asynchronous Workflow Manager:**Crucial for managing long-running external processes (like calling an AI). The status field allows other services to reliably track progress.                                     | **Stuck Report:**Error if the AI finishes but the database update fails.**Prevention:**Use an**Asynchronous Messaging Queue**(RabbitMQ/Kafka) where the AI posts a completion message, and a dedicated worker reliably updates the report status. |
| **`AcademicHistory.js`** | **The Academic Ledger:**Stores the immutable, historical record of a student's grades for every year and class.                                                          | **Immutable Ledger (Append-Only):**You only**add**new history; you never change old history. This provides an indisputable, tamper-proof **audit trail** , essential for university applications. | **Missing Link:**Error if a final grade is recorded but the report card link is missing.**Prevention:**The final promotion feature must use a**multi-document transaction**to write the report, grade, and history link all at once.              |

---

## 5. Communications, Documents & Workflow (The Messaging System üì£)

This group manages temporary admissions data, general content distribution, staff tasks, and internal document storage.

| **Model**                    | **Purpose & Use**                                                                                                                                    | **DSE Core Concept**                                                                                                                                                                                                     | **Possible Errors & Prevention**                                                                                                                                                                                                               |
| ---------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **`Announcement.js`**      | **The Staff/Student Memo:**Stores text-based announcements that can target roles or specific classes.                                                      | **Single Source of Truth (SSoT) for Messaging:**Users fetch the message from one place, ensuring a message cannot be accidentally deleted from a user's profile while still active for others.                                 | **Notification Delay:**Users only see an announcement when they check the app.**Improvement:**Integrate with a**real-time WebSocket**service (Socket.IO) to push new announcements directly to the user's screen.                        |
| **`GeneralContent.js`**    | **The Public Content Uploader:**For highly generic, non-personal content like menus, timetables, and policies. Uses `target_audience`for access control. | **Scalable Content Distribution:**Allows you to query a small group of content documents based on `target_audience: 'Public'`without slowing down a core user table search, ensuring **fast website performance** .    | **Access Violation:**Error if a staff-only document is marked `Public`.**Prevention:**Require Admin approval and a confirmation prompt on saving any document with the `Public`audience flag.                                                    |
| **`StaffDocument.js`**     | **Personal Staff Document Storage:**Stores private documents (like contracts or personal certificates) for individual staff.                               | **Data Decoupling & Content Delivery Network (CDN) Linkage:**The model stores a secure link (`file_url`) to the file in a CDN, reducing database size and improving file delivery speed.                                     | **Unauthorized Access:**Error if a staff member can view a private contract.**Prevention:**The API query must strictly enforce that the requested document's `staff_id`equals the requesting user's `staffId`from their token.                   |
| **`Task.js`**              | **Staff To-Do List:**Stores tasks assigned to staff, tracking status and due dates.                                                                        | **Worker Queue Decoupling (Task Abstraction):**Creates a central task queue, which is highly efficient. It avoids embedding large lists of tasks into every `Staff.User.js`profile, making profile updates fast.             | **Stale Task Data:**Error if a staff member deletes a task locally but the central status isn't updated.**Prevention:**The `Task.js`must be the**SSoT**for task status; all front-end updates must hit this central model.             |
| **`PendingEnrollment.js`** | **Admissions Staging Area:**Holds raw, unverified student data, payment status, and approval status before the final record is created.                    | **Staging Area & Transactional Integrity:**Protects the core `Student`and `User`models from incomplete or fraudulent data. The final step is a**transaction**that moves the data from here to the core models. | **Data Persistence:**Error if old, abandoned applications remain forever.**Prevention:**Implemented a**TTL (Time-To-Live) Index**on the document that automatically deletes old, failed applications after a set period (e.g., 90 days). |

---
